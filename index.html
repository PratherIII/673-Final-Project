<!DOCTYPE html>
<html lang= "en">
<head>
    <meta charset = "utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>KPFC Fire Portal Visualizer</title>

    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.3.1/cerulean/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-C++cugH8+Uf86JbNOnQoBweHHAe/wVKN/mb0lTybu/NZ9sEYbd+BbbYtNpWYAsNP" crossorigin="anonymous">
    <link href="data/style.css" rel='stylesheet'/>
    <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'>
    <style>
    </style>

</head>

<body>
        <div class="container-fluid">
            <div class="row">
                <div class="header bg-warning col-12 border border-dark">
                    <h1 class="text-center text-dark py-2 px-2">
                        Kentucky Prescribed Burning Activity
                    </h1>
                </div>
            </div>
                <div class="row">
                    <div class="col-1 col-sm-2 col-md-3">
                        <h3>
                            h3. Lorem ipsum dolor sit amet.
                        </h3>
                        <p class="lead border">
                            Lorem ipsum dolor sit amet, <strong>consectetur adipiscing elit</strong>. Aliquam eget sapien sapien. Curabitur in metus urna. In hac habitasse platea dictumst. Phasellus eu sem sapien, sed vestibulum velit. Nam purus nibh, lacinia non faucibus et, pharetra in dolor. Sed iaculis posuere diam ut cursus. Proin massa magna, vulputate nec bibendum nec, posuere nec lacus. Aliquam mi erat, aliquam vel luctus eu, pharetra quis elit. Nulla euismod ultrices massa, et feugiat ipsum consequat eu.
                        </p>
                        <p class ="footer">
                            <ul>
                                   <li>Data Courtesy of <a href="www.KentuckyPrescribedFireCouncil.com">Kentucky Prescribed Fire Council</a>.</li> 
                                   <li>Check out my <a href="www.github.com/pratheriii>Github Profile">Github Profile</a></li>
                            </ul>

                        </p>
                    </div>
                    <div class="col-12 col-sm-10 col-md-9">
                        <div id="map" class = 'bg-light position-absolute'>
                        <div class="dropdown">
                            <!-- <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown">
                                Action
                            </button> -->
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                 <a class="dropdown-item disabled" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script>
    //begin javascript functions
    const countiesJson = d3.json('data/kentucky_counties.json');
    const burnsCSV = d3.csv('data/burn_points.CSV');

    const mapContainer = d3.select('#map');

    const width = mapContainer.node().offsetWidth - 60;
    const height = mapContainer.node().offsetHeight - 60;

    const svg = mapContainer
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .classed('position-absolute', true)
        .style('top', 40)
        .style('left', 40);

        // Create  div for the tooltip and hide with opacity
      const tooltip = d3.select('.container-fluid').append('div')
        .attr('class', 'my-tooltip bg-dark text-white py-1 px-2 rounded position-absolute invisible');

      mapContainer
        .on('mousemove', event => {
          // update the position of the tooltip
          tooltip.style('left', (d3.event.pageX + 10) + 'px')
            .style('top', (d3.event.pageY - 30) + 'px');
        });

    // console.log(data);
    Promise.all([countiesJson, burnsCSV])
    .then(drawMap)
    .catch(error => {
        console.log(error)
    });


    function drawMap(data) {

        // console.log(data);
    

    const countiesData = data[0];
    const burnsData = data[1];

    // console.log(countiesData);

    const countiesGeoJson = topojson.feature(countiesData, {
        type: 'GeometryCollection',
        geometries: countiesData.objects.kentucky_counties.geometries
    });

    const projection = d3.geoMercator()
    .fitSize([width, height], countiesGeoJson);

    const path = d3.geoPath()
    .projection(projection);

    const counties = svg.append('g')
        .selectAll('path')
        .data(countiesGeoJson.features)
        .join('path')
        .attr('d', path)
        .attr('class', 'county');

        // console.log(burnsData);
        const radius = d3.scaleSqrt().domain([0, 4500]).range([1, 25]);

        const color = d3.scaleOrdinal(d3.schemeDark2);


        // const day = [];

     const burns = svg.append('g') // append new g element
        .selectAll('circle') // select all the circles
        .data(burnsData.sort(function (a, b) {
          return b.AcresBurnUnit - a.AcresBurnUnit; // place the large ones on the bottom
        }))
        .join('circle') // join that data to circle elements
        .attr('cx', d => { // feed the long/lat to the projection generator
          d.position = projection([d.Long, d.Lat]); // create a new data attribute
          return d.position[0]; // position the x
        })
        .attr('cy', d => {
          return d.position[1]; // position the y
        })
        .attr('r', d => {
          return radius(+d.AcresBurnUnit);
        })
        .style('fill', d => {
          return color(d.InChangeOfName);
        })
        .attr('class', 'burn');
        .attr('date', d => d.DateBurn);
        .attr('day', d => Date.parse(d.DateBurn));
        // .attr('day', d => {d.DateBurn.parse}; // give each circle a class name

        // burnsData.forEach(element =>console.log(element.DateBurn));
        // const day = burns.forEach[data].DateBurn;
        // console.log(day);
    
        // applies event listeners to our polygons for user interaction
      burns.on('mouseover', (d, i, nodes) => { // when mousing over an element
          console.log(d);
          const name = d.BurnName;
          const date = d.DateBurn;
          const agency = d.AgencyName;
          const locations = d.CountyName;
          const inCharge  = d.InChangeOfName;
        
          d3.select(nodes[i]).classed('hover', true).raise();
          console.log(d); // select it, add a class name, and bring to front
          tooltip.classed('invisible', false).html("<g>" + date + "<br>" + agency + "<br>" + locations + " County <br>" +
            inCharge +"</g>" );
        })
        .on('mouseout', (d, i, nodes) => { // when mousing out of an element
          d3.select(nodes[i]).classed('hover', false) // remove the class from the polygon
          tooltip.classed('invisible', true) // hide the element 
        });

    }    
    </script>
</body>
</html> 